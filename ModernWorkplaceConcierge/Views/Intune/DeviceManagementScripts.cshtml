@model IEnumerable<Microsoft.Graph.DeviceManagementScript>

@{
    ViewBag.Current = "IntuneDeviceManagementScripts";
}

<script src="~/Content/Prismjs/prism.js"></script>
<link rel="stylesheet" href="~/Content/Prismjs/prism.css">

<div class="jumbotron">
    <h1>PowerShell Scripts</h1>
    <p>View and download PowerShell scripts from your Intune tenant.</p>
</div>

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.DisplayName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FileName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.LastModifiedDateTime)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.DisplayName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.FileName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.LastModifiedDateTime)
            </td>
            <td>
                <a href="javascript:void(0);" class="anchorDetail" data-id="@item.Id">Preview</a> |
                @Html.ActionLink("Download", "DownloadDeviceManagementScript", new { Id = item.Id })
            </td>
        </tr>
    }
</table>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="myModal" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="border:none">
                <h5 class="modal-title">PowerShell Preview</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <pre class="line-numbers">
                <code id="myModalContent" class="language-powershell"></code>
            </pre>
            <div class="modal-footer" style="border:none">
                <button type="button" id="closbtn" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    var URL = '/Intune/PowerShellScriptContent';
    $(function () {
        $(".anchorDetail").click(function () {
            debugger;
            var $buttonClicked = $(this);
            var id = $buttonClicked.attr('data-id');

            $.ajax({
                type: "GET",
                url: URL,
                contentType: "text/plain; charset=utf-8",
                data: { "Id": id },
                datatype: "text/html",
                success: function (data) {
                    debugger;
                    $('#myModalContent').html(data);
                    $('#myModal').modal('show');
                    Prism.highlightAll();
                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
        });
    });  
</script>



